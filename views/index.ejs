<!doctype html>
<html>

<head>
  <title>Multi Web Audio Sequencer</title>
  <meta charset="UTF-8">
  <title>808 Sequencer</title>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../assets/stylesheets/styles.css">
</head>

<body>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="/socket.io/socket.io.js"></script>
  <h1>Multi Web Audio Sequencer</h1>



  <div class="container">
    <div class="row">
      <h1>Web Audio Drum Sequencer</h1>
      <h2>Loaded with Roland TR-808 Samples</h2>
    </div>
    <div class="row">
      <button id="play-pause" type="button" class="btn btn-default btn-lg noselect">
        <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
      </button>
      <span class="tempo-container">
        <label for="tempo-input" >Tempo </label>
        <input id="tempo-input" type="number" disabled>
        <span id="decrease-tempo" class="glyphicon glyphicon-minus btn btn-default tempo-btn"></span>
      <span id="increase-tempo" class="glyphicon glyphicon-plus btn btn-default tempo-btn"></span>
      </span>
    </div>
    <div class="instruments">
      <div></div>
    </div>
    <div class="row">
      <input type="text" id="newTrackName" placeholder="New track name">
      <button type="button" id="addNewTrack">New track</button>
    </div>
    <div class="row">
      <div class="filter-controls col-md-4">
        <div class="control">
          <button id="lpf" class="btn btn-default btn-lg">Low Pass Filter</button>
        </div>
        <div class="control">
          <label for="freq-slider">Cutoff Frequency</label>
          <div id="freq-slider"></div>
        </div>
        <div class="control">
          <label for="quality-slider">Quality</label>
          <div id="quality-slider"></div>
        </div>
      </div>
      <div class="effect-controls col-md-4">
        <div class="control">
          <button id="reverb" class="btn btn-default btn-lg">Reverb</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Javascripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="./assets/javascripts/kit.js"></script>
  <script type="text/javascript" src="./assets/javascripts/impulse-response.js"></script>
  <script type="text/javascript" src="./assets/javascripts/app.js"></script>
  <script>
    function addClickEvent(socket, instrument = null) {
      if (instrument) {
        // if an instrument is given, select the pads of it
        var pads = $('div[data-instrument="' + instrument + '"]').children(".pad");
      } else {
        // if there is no instrument given, select all the pads
        var pads = $('.pad');
      }
      pads.click(function() {
        console.log($(this));
        socket.emit('pad', toggleSelectedListener($(this)));
      });
    }

    function sendNewTrack(trackName) {
      socket.emit('newTrack', trackName)
    }

    $(function() {
      socket = io.connect('http://localhost:8080');
      addClickEvent(socket);

      // on recieve sequencer state
      socket.on('SendCurrentState', function(json) {
        console.log("ReceiveCurrentSequencerState", json);
        TranslateStateInActions(json);
      })

      // on recieve pad change
      socket.on('sendPad', function(event) {
        console.log('Valeur des pads re√ßues', event);
        toggleSelectedListenerSocket(event);
      });

      // on recieve new track
      socket.on('sendNewTrack', function(message) {
        addNewTrack(message);
        console.log('recieveNewTrack: ' + message);
      });
    })
  </script>
</body>

</html>